#!/bin/bash

# This has to be the first command because BASH_SOURCE[0] gets changed.
SCRIPT=${BASH_SOURCE[0]:-$0}

[[ "${BASH_SOURCE[0]}" == "$0" ]] \
    && printf "This script should not be executed but sourced like:\n    $ source $0\n" \
    && exit 1

SCRIPTDIR=$(dirname $(realpath $SCRIPT))
export XDGAPP_ENVPATH=$(realpath $SCRIPTDIR/../../)
export CURRENT_GST=$XDGAPP_ENVPATH
export MYPITIVI=$XDGAPP_ENVPATH

export make="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b make"
export check="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b make check"
export minstall="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b make install"
export autogen="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b ./autogen.sh --prefix=/app --disable-gtk-doc"
export configure="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b ./configure --prefix=/app --disable-gtk-doc"

alias make=$make
alias check=$check
alias minstall=$minstall
alias autogen=$autogen
alias configure=$configure

alias ptvenv="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b"

echo "-> Setting up environment if needed..."
ptvenv "echo"
if [ "$?" = "0" ];
then
    for i in `ptvenv ls /app/bin/`;
    do
        alias $i="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b $i"
    done

    alias pitivi="$XDGAPP_ENVPATH/pitivi/build/flatpak/pitivi-flatpak -b bin/pitivi"

    export PS1="(ptv-xdgapp) $PS1"
    export PATH="$XDGAPP_ENVPATH/bin/:$PATH"

    echo "===================================================================="
    echo "                   BATTLECRUISER OPERATIONAL                        "
    echo "                          >(Â°)__/                                   "
    echo "                           (_~_/                                    "
    echo "                         ~~~~~~~~~~~~                               "
    echo "===================================================================="
fi
